<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GALAGA: VOID WAR</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:Arial;color:white}
canvas{display:block;margin:auto}
#menu{position:absolute;inset:0;background:rgba(0,0,0,.9);display:flex;flex-direction:column;justify-content:center;align-items:center}
button{padding:12px 30px;margin:8px;font-size:18px;cursor:pointer}
#hud{position:absolute;top:10px;left:10px;font-size:18px}
</style>
</head>
<body>

<div id="menu">
<h1>GALAGA: VOID WAR</h1>
<button onclick="startGame(1)">Easy</button>
<button onclick="startGame(2)">Medium</button>
<button onclick="startGame(3)">Hard</button>
<p id="hi"></p>
</div>

<div id="hud"></div>
<canvas id="game" width="600" height="800"></canvas>

<script>
const c=document.getElementById("game"),x=c.getContext("2d");
let k={},stars=[],player,enemies=[],enemyBullets=[],powerUps=[],explosions=[];
let score=0,level=1,diff=1,run=false,shake=0;
let hi=localStorage.hiScore||0;
document.getElementById("hi").innerText="High Score: "+hi;

addEventListener("keydown",e=>k[e.key.toLowerCase()]=1);
addEventListener("keyup",e=>k[e.key.toLowerCase()]=0);

/* ===== BACKGROUND ===== */
for(let i=0;i<200;i++)stars.push({x:Math.random()*600,y:Math.random()*800,s:Math.random()*2+1});
function drawStars(){
x.fillStyle="white";
stars.forEach(s=>{
x.fillRect(s.x,s.y,2,2);
s.y+=s.s;
if(s.y>800){s.y=0;s.x=Math.random()*600;}
});
}

/* ===== PLAYER ===== */
function spawnPlayer(){
player={x:300,y:700,w:40,h:50,spd:6,cd:0,shield:0,shots:1};
}

/* ===== ENEMIES ===== */
function spawnWave(){
enemies=[];
for(let i=0;i<5+level;i++)
enemies.push({x:Math.random()*540,y:50+Math.random()*200,w:40,h:30,dx:(Math.random()<.5?-1:1)*(1+diff),hp:1});
if(level%5===0) enemies.push({x:200,y:80,w:200,h:60,dx:2*diff,hp:20,boss:1});
}

/* ===== GAME START ===== */
function startGame(d){
diff=d;score=0;level=1;
spawnPlayer();spawnWave();
enemyBullets=[];powerUps=[];explosions=[];
document.getElementById("menu").style.display="none";
run=true;loop();
}

/* ===== UPDATE ===== */
function update(){
if(!run)return;
if(k.a&&player.x>0)player.x-=player.spd;
if(k.d&&player.x+player.w<600)player.x+=player.spd;
if(k.w&&player.y>0)player.y-=player.spd;
if(k.s&&player.y+player.h<800)player.y+=player.spd;

if(k[" "]&&player.cd<=0){
for(let i=0;i<player.shots;i++)
enemyBullets.push({x:player.x+player.w/2-2+i*8-4,y:player.y,dy:-8,ply:1});
player.cd=15;
}
if(player.cd>0)player.cd--;

enemyBullets.forEach(b=>b.y+=b.dy);
enemies.forEach(e=>{
e.x+=e.dx;
if(e.x<0||e.x+e.w>600)e.dx*=-1;
if(Math.random()<.01*diff&&!b.ply)
enemyBullets.push({x:e.x+e.w/2,y:e.y+e.h,dy:4});
});

enemyBullets.forEach((b,i)=>{
if(b.ply){
enemies.forEach((e,ei)=>{
if(b.x>e.x&&b.x<e.x+e.w&&b.y>e.y&&b.y<e.y+e.h){
e.hp--;enemyBullets.splice(i,1);shake=5;
if(e.hp<=0){explode(e.x+e.w/2,e.y+e.h/2);enemies.splice(ei,1);score+=e.boss?100:10;
if(Math.random()<.3)powerUps.push({x:e.x,y:e.y,t:Math.random()<.5?"triple":"shield"});}
}
});
}else{
if(b.x>player.x&&b.x<player.x+player.w&&b.y>player.y&&b.y<player.y+player.h){
if(player.shield>0)player.shield--; else gameOver();
}
}
});

powerUps.forEach(p=>p.y+=2);
powerUps.forEach((p,i)=>{
if(p.x>player.x&&p.x<player.x+player.w&&p.y>player.y&&p.y<player.y+player.h){
if(p.t=="triple")player.shots=3;
if(p.t=="shield")player.shield=5;
powerUps.splice(i,1);
}
});

explosions.forEach(e=>e.r+=2);

if(enemies.length===0){level++;spawnWave();}
document.getElementById("hud").innerText=`Score:${score} Level:${level} Shield:${player.shield}`;
}

/* ===== DRAW ===== */
function draw(){
x.save();
if(shake)x.translate(Math.random()*shake-shake/2,Math.random()*shake-shake/2);
x.clearRect(0,0,600,800);
drawStars();

x.fillStyle="cyan";
x.beginPath();
x.moveTo(player.x+20,player.y);
x.lineTo(player.x,player.y+50);
x.lineTo(player.x+40,player.y+50);
x.fill();

x.fillStyle="yellow";
enemyBullets.filter(b=>b.ply).forEach(b=>x.fillRect(b.x,b.y,4,10));
x.fillStyle="red";
enemyBullets.filter(b=>!b.ply).forEach(b=>x.fillRect(b.x,b.y,4,10));

enemies.forEach(e=>{
x.fillStyle=e.boss?"darkred":"purple";
x.fillRect(e.x,e.y,e.w,e.h);
});

powerUps.forEach(p=>{
x.fillStyle=p.t=="triple"?"lime":"cyan";
x.fillRect(p.x,p.y,20,20);
});

explosions.forEach(e=>{
x.strokeStyle="orange";
x.beginPath();x.arc(e.x,e.y,e.r,0,Math.PI*2);x.stroke();
});

x.restore();
if(shake>0)shake--;
}

/* ===== HELPERS ===== */
function explode(xp,yp){explosions.push({x:xp,y:yp,r:5});}
function gameOver(){
run=false;
if(score>hi){hi=score;localStorage.hiScore=hi;}
document.getElementById("menu").style.display="flex";
document.getElementById("hi").innerText="High Score: "+hi;
}
function loop(){update();draw();if(run)requestAnimationFrame(loop);}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaga Redux</title>
<style>
html,body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{
  display:block;
  margin:auto;
  background:black;
}
button{
  padding:10px 20px;
  margin:6px;
  font-size:16px;
  border:none;
  cursor:pointer;
}
#menu,#shop{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:linear-gradient(#000,#050b2e);
}
.hidden{display:none}
.levelBtn{width:260px}
</style>
</head>

<body>

<canvas id="game" width="720" height="900"></canvas>

<div id="menu">
  <h1>GALAGA REDUX</h1>
  <div id="levelList"></div>
  <button onclick="openShop()">SHOP</button>
</div>

<div id="shop" class="hidden">
  <h2>SHIP SHOP</h2>
  <p id="coinText"></p>
  <div id="shipList"></div>
  <button onclick="closeShop()">BACK</button>
</div>

<script>
/* ================= DOM ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const menu = document.getElementById("menu");
const shop = document.getElementById("shop");
const levelList = document.getElementById("levelList");
const shipList = document.getElementById("shipList");
const coinText = document.getElementById("coinText");

/* ================= INPUT ================= */
let keys = {};
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

/* ================= SAVE ================= */
let coins = Number(localStorage.coins||0);
let owned = JSON.parse(localStorage.owned||"[0]");
let equipped = Number(localStorage.equipped||0);

/* ================= GAME STATE ================= */
let state="MENU";
let animationId;

/* ================= SHIPS ================= */
const ships=[
{ name:"Scout", cost:0, draw:(x,y)=>{
  ctx.beginPath();
  ctx.moveTo(x,y-18);
  ctx.lineTo(x-12,y+18);
  ctx.lineTo(x+12,y+18);
  ctx.closePath();
  ctx.fill();
}},
{ name:"Falcon", cost:150, draw:(x,y)=>{
  ctx.beginPath();
  ctx.moveTo(x,y-20);
  ctx.lineTo(x-20,y+18);
  ctx.lineTo(x,y+8);
  ctx.lineTo(x+20,y+18);
  ctx.closePath();
  ctx.fill();
}},
{ name:"Phantom", cost:350, draw:(x,y)=>{
  ctx.beginPath();
  ctx.moveTo(x,y-22);
  ctx.lineTo(x-16,y+18);
  ctx.lineTo(x+16,y+18);
  ctx.closePath();
  ctx.fill();
  ctx.fillRect(x-4,y-6,8,18);
}},
{ name:"Nova", cost:700, draw:(x,y)=>{
  ctx.beginPath();
  ctx.moveTo(x,y-24);
  ctx.lineTo(x-22,y+16);
  ctx.lineTo(x+22,y+16);
  ctx.closePath();
  ctx.fill();
  ctx.fillRect(x-6,y-8,12,22);
}}
];

/* ================= LEVELS ================= */
const levels=[
{ name:"ASTEROID DRIFT", diff:1 },
{ name:"NEBULA SWARM", diff:2 },
{ name:"CRIMSON FRONT", diff:3 },
{ name:"VOID ASSAULT", diff:4 },
{ name:"EXTINCTION ZONE", diff:5 }
];

/* ================= GAME OBJECTS ================= */
let player, enemies=[], pBullets=[], powerUps=[];
let fireCooldown=0;
let currentLevel;

/* ================= MENU BUILD ================= */
levels.forEach((l,i)=>{
  const b=document.createElement("button");
  b.className="levelBtn";
  const r=Math.min(255,60+l.diff*40);
  b.style.background=`rgb(${r},0,0)`;
  b.textContent=l.name;
  b.onclick=()=>startLevel(i);
  levelList.appendChild(b);
});

/* ================= SHOP ================= */
function openShop(){
  state="SHOP";
  menu.classList.add("hidden");
  shop.classList.remove("hidden");
  drawShop();
}
function closeShop(){
  state="MENU";
  shop.classList.add("hidden");
  menu.classList.remove("hidden");
}
function drawShop(){
  shipList.innerHTML="";
  coinText.textContent=`Coins: ${coins}`;
  ships.forEach((s,i)=>{
    const b=document.createElement("button");
    if(owned.includes(i)){
      b.textContent = (i===equipped) ? "EQUIPPED" : `Equip ${s.name}`;
      b.onclick=()=>{equipped=i;save();}
    }else{
      b.textContent = `Buy ${s.name} (${s.cost})`;
      b.onclick=()=>{
        if(coins>=s.cost){
          coins-=s.cost;
          owned.push(i);
          save();
          drawShop();
        }
      }
    }
    shipList.appendChild(b);
  });
}

/* ================= GAME START ================= */
function startLevel(i){
  currentLevel = levels[i];
  state="PLAY";
  menu.classList.add("hidden");
  shop.classList.add("hidden");
  spawnGame();
  loop();
}

/* ================= SPAWN ================= */
function spawnGame(){
  player={x:360,y:780,shots:1,shield:0};
  enemies=[];
  pBullets=[];
  powerUps=[];
  for(let r=0;r<3+currentLevel.diff;r++){
    for(let c=0;c<8;c++){
      enemies.push({
        x:90+c*70,
        y:80+r*50,
        hp:1+Math.floor(currentLevel.diff/2),
        dx:1+currentLevel.diff*0.4
      });
    }
  }
}

/* ================= POWER UPS ================= */
function dropPowerUp(x,y){
  const types=["triple","rapid","shield"];
  powerUps.push({x,y,type:types[Math.floor(Math.random()*types.length)],rot:0});
}
function applyPowerUp(t){
  if(t==="triple") player.shots=3;
  if(t==="rapid") fireCooldown=5;
  if(t==="shield") player.shield=3;
}

/* ================= LOOP ================= */
function loop(){
  animationId=requestAnimationFrame(loop);
  update();
  draw();
}
function update(){
  if(state!=="PLAY") return;

  if(keys.a) player.x-=6;
  if(keys.d) player.x+=6;
  if(keys.w) player.y-=6;
  if(keys.s) player.y+=6;

  if(keys[" "] && fireCooldown<=0){
    for(let i=0;i<player.shots;i++){
      pBullets.push({x:player.x+i*6-player.shots*3,y:player.y});
    }
    fireCooldown=15;
  }
  fireCooldown--;

  pBullets.forEach(b=>b.y-=10);

  enemies.forEach(e=>{
    e.x+=e.dx;
    if(e.x<40||e.x>680) e.dx*=-1;
  });

  pBullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(Math.abs(b.x-e.x)<18 && Math.abs(b.y-e.y)<18){
        e.hp--;
        pBullets.splice(bi,1);
        if(e.hp<=0){
          enemies.splice(ei,1);
          coins+=5;
          if(Math.random()<0.3) dropPowerUp(e.x,e.y);
        }
      }
    });
  });

  powerUps.forEach((p,i)=>{
    p.y+=2; p.rot+=0.1;
    if(Math.abs(p.x-player.x)<20 && Math.abs(p.y-player.y)<20){
      applyPowerUp(p.type);
      powerUps.splice(i,1);
    }
  });

  if(enemies.length===0){
    save();
    cancelAnimationFrame(animationId);
    state="MENU";
    menu.classList.remove("hidden");
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,720,900);
  if(state!=="PLAY") return;

  ctx.fillStyle="white";
  ships[equipped].draw(player.x,player.y);

  ctx.fillStyle="yellow";
  pBullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));

  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x-16,e.y-16,32,32));

  powerUps.forEach(p=>{
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.strokeStyle="cyan";
    ctx.beginPath();
    ctx.arc(0,0,10,0,Math.PI*2);
    ctx.stroke();
    ctx.restore();
  });

  ctx.fillText(`Coins: ${coins}`,10,20);
}

/* ================= SAVE ================= */
function save(){
  localStorage.coins=coins;
  localStorage.owned=JSON.stringify(owned);
  localStorage.equipped=equipped;
}

/* ================= INIT ================= */
state="MENU";
menu.classList.remove("hidden");
shop.classList.add("hidden");
</script>

</body>
</html>

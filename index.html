<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GALAGA: VOID WAR Ultimate</title>
<style>
body {margin:0; background:black; overflow:hidden; font-family:Arial,sans-serif; color:white;}
canvas {display:block; margin:auto; background:#000;}
#overlay {
  position:absolute; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center;
  background:black; color:white; font-size:20px; overflow:hidden;
}
button {
  padding:12px 28px; margin:8px; font-size:18px; cursor:pointer; border:none; border-radius:6px; font-weight:bold;
  transition: transform 0.2s, box-shadow 0.2s;
}
button:hover {transform: scale(1.1); box-shadow: 0 0 10px white;}
#easy {background:green; color:black;}
#medium {background:yellow; color:black;}
#hard {background:red; color:white;}
#hud {position:absolute; top:10px; left:10px; font-size:16px;}
#instructions {font-size:16px; margin-top:10px; text-align:center;}
</style>
</head>
<body>
<div id="overlay">
  <h1 id="title" style="font-size:48px;">GALAGA: VOID WAR</h1>
  <div id="instructions">
    <p>WASD: Move | SPACE: Shoot | P: Pause</p>
  </div>
  <div>
    <button id="easy" onclick="startGame(1)">Easy</button>
    <button id="medium" onclick="startGame(2)">Medium</button>
    <button id="hard" onclick="startGame(3)">Hard</button>
  </div>
  <p id="hi"></p>
</div>
<div id="hud"></div>
<canvas id="game" width="600" height="800"></canvas>

<script>
const canvas=document.getElementById("game"), ctx=canvas.getContext("2d");
let keys={}, stars=[], player, enemies=[], pBullets=[], eBullets=[], powerUps=[], fx=[];
let score=0, level=1, diff=1, run=false, paused=false, shake=0, lives=3;
let hi = localStorage.hiScore||0;
document.getElementById("hi").innerText="High Score: "+hi;

// Animate title pulsing
let titlePulse=1, pulseDir=0.005;
const titleElem=document.getElementById("title");

// Starfield background
for(let i=0;i<200;i++) stars.push({x:Math.random()*600, y:Math.random()*800, s:1+Math.random()*2});
function drawStars(){ctx.fillStyle="white"; stars.forEach(s=>{ctx.fillRect(s.x,s.y,2,2); s.y+=s.s; if(s.y>800){s.y=0; s.x=Math.random()*600;}});}

// Audio beep
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function beep(freq,len){const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.frequency.value=freq; o.start(); g.gain.setValueAtTime(.1,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+len); o.stop(audioCtx.currentTime+len);}

// Key handling
addEventListener("keydown", e=>keys[e.key.toLowerCase()]=1);
addEventListener("keyup", e=>keys[e.key.toLowerCase()]=0);

// Player spawn
function spawnPlayer(){player={x:280,y:700,w:40,h:50,spd:6,cd:0,shots:1,shield:0};}

// Enemy wave
function spawnWave(){
  enemies=[]; eBullets=[];
  let cols=5, rows=1+Math.min(level,3);
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      let hp = Math.random()<0.2?2:1;
      enemies.push({x:100+c*80, y:60+r*50, w:40, h:30, hp:hp, dx:(r%2?1:-1)*(1+diff*0.5), cd:0, dive:false, targetY:null, diveAngle:0});
    }
  }
  if(level%5===0) enemies.push({x:200,y:40,w:200,h:60,hp:15,boss:1,dx:2*diff,cd:0,dive:false,targetY:null,diveAngle:0});
}

// Start game
function startGame(d){
  diff=d; score=0; level=1; lives=3;
  spawnPlayer(); spawnWave();
  pBullets=[]; powerUps=[]; fx=[]; eBullets=[];
  paused=false; run=true;
  document.getElementById("overlay").style.display="none";
  loop();
}

// Update
function update(){
  if(!run) return;

  if(document.getElementById("overlay").style.display!="none"){
    titlePulse+=pulseDir;
    if(titlePulse>1.1||titlePulse<0.9) pulseDir*=-1;
    titleElem.style.transform=`scale(${titlePulse})`;
  }

  if(paused) return;
  if(keys.p){paused=true; setTimeout(()=>keys.p=0,200);}

  // Player movement
  if(keys.a && player.x>0) player.x -= player.spd;
  if(keys.d && player.x+player.w<600) player.x += player.spd;
  if(keys.w && player.y>400) player.y -= player.spd;
  if(keys.s && player.y+player.h<780) player.y += player.spd;

  // Shooting
  if(keys[" "] && player.cd<=0){
    for(let i=0;i<player.shots;i++) pBullets.push({x:player.x+20+i*8-4,y:player.y});
    player.cd=18; beep(700,.05);
  }
  if(player.cd>0) player.cd--;

  // Move bullets
  pBullets.forEach(b=>b.y-=12);
  eBullets.forEach(b=>b.y+=5);

  // Enemy movement & dives
  enemies.forEach(e=>{
    if(!e.dive) e.x += e.dx;
    if(e.x<0||e.x+e.w>600) e.dx*=-1;

    // Dive initiation
    if(Math.random()<(0.01*diff) && !e.dive){ 
      e.dive=true; e.targetY=600+Math.random()*100; e.diveAngle=Math.random()*Math.PI/2-0.25;
    }

    // Dive motion (curved)
    if(e.dive){
      e.x += Math.sin(e.diveAngle)*3; 
      e.y += Math.cos(e.diveAngle)*3;
      e.diveAngle += 0.02;
      if(e.y>800) e.dive=false; // remove dive when off-screen
    }

    if(Math.random()<(0.005*diff) && e.cd<=0){ eBullets.push({x:e.x+e.w/2, y:e.y}); e.cd=60; }
    if(e.cd>0) e.cd--;
  });

  // Collisions
  pBullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(b.x>e.x&&b.x<e.x+e.w && b.y>e.y&&b.y<e.y+e.h){
        e.hp--; pBullets.splice(bi,1); shake=6;
        if(e.hp<=0){
          enemies.splice(ei,1); score+=e.boss?200:10;
          fx.push({x:e.x+e.w/2,y:e.y+e.h/2,r:5}); beep(200,.1);
          if(Math.random()<.3) powerUps.push({x:e.x,y:e.y,t:Math.random()<.5?"triple":"shield"});
        }
      }
    });
  });

  eBullets.forEach((b,i)=>{
    if(b.x>player.x&&b.x<player.x+player.w && b.y>player.y&&b.y<player.y+player.h){
      if(diff<3 && player.shield>0) player.shield--;
      else {
        lives--;
        if(lives>0) spawnPlayer();
        else gameOver();
      }
      eBullets.splice(i,1);
    }
  });

  // Power-ups
  powerUps.forEach(p=>p.y+=2);
  powerUps.forEach((p,i)=>{
    if(p.x>player.x&&p.x<player.x+player.w && p.y>player.y&&p.y<player.y+player.h){
      if(p.t=="triple") player.shots=3;
      if(p.t=="shield") player.shield=5;
      powerUps.splice(i,1);
    }
  });

  fx.forEach(f=>f.r+=2);

  // Level up if enemies gone or below screen
  if(enemies.length===0 || enemies.every(e=>e.y>800)){level++; spawnWave();}

  document.getElementById("hud").innerText =
    `Score:${score} Level:${level} Lives:${lives} Shield:${player.shield} ${paused?"PAUSED":""}`;
}

// Draw
function draw(){
  ctx.save();
  if(shake) ctx.translate(Math.random()*shake-shake/2, Math.random()*shake-shake/2);
  ctx.clearRect(0,0,600,800);
  drawStars();

  // Player ship
  ctx.fillStyle="cyan"; ctx.beginPath();
  ctx.moveTo(player.x+20,player.y);
  ctx.lineTo(player.x,player.y+50);
  ctx.lineTo(player.x+10,player.y+40);
  ctx.lineTo(player.x+30,player.y+40);
  ctx.lineTo(player.x+40,player.y+50);
  ctx.fill();
  ctx.fillStyle="white"; ctx.fillRect(player.x+18,player.y+10,4,10);

  // Bullets
  ctx.fillStyle="yellow"; pBullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));
  ctx.fillStyle="red"; eBullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));

  // Enemies
  enemies.forEach(e=>{
    ctx.fillStyle=e.boss?"darkred":e.hp==2?"orange":"purple";
    ctx.fillRect(e.x,e.y,e.w,e.h);
    if(e.boss){ctx.fillStyle="white"; ctx.fillRect(e.x+e.w/2-5,e.y+10,10,10);}
  });

  // Explosions
  fx.forEach(f=>{ctx.strokeStyle="orange";ctx.beginPath();ctx.arc(f.x,f.y,f.r,0,Math.PI*2);ctx.stroke();});
  // Power-ups
  powerUps.forEach(p=>{ctx.fillStyle=p.t=="triple"?"lime":"cyan"; ctx.fillRect(p.x,p.y,20,20);});

  ctx.restore();
  if(shake>0) shake--;
}

// Loop
function loop(){update(); draw(); if(run) requestAnimationFrame(loop);}

// Game over
function gameOver(){
  run=false;
  if(score>hi){hi=score; localStorage.hiScore=hi;}
  document.getElementById("hi").innerText="High Score: "+hi;
  document.getElementById("overlay").style.display="flex";
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaga Redux</title>
<style>
html,body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{
  display:block;
  margin:auto;
  background:black;
}
button{
  padding:10px 20px;
  margin:6px;
  font-size:16px;
  cursor:pointer;
  border:none;
}
#menu,#shop{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:linear-gradient(#000,#050b2e);
}
.hidden{display:none}
.levelBtn{width:260px}
</style>
</head>

<body>

<canvas id="game" width="720" height="900"></canvas>

<div id="menu">
  <h1>GALAGA REDUX</h1>
  <div id="levels"></div>
  <button id="shopBtn">SHOP</button>
</div>

<div id="shop" class="hidden">
  <h2>SHIP SHOP</h2>
  <p id="coinsTxt"></p>
  <div id="ships"></div>
  <button id="backBtn">BACK</button>
</div>

<script>
/* ================== DOM ================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const menu = document.getElementById("menu");
const shop = document.getElementById("shop");
const levelsDiv = document.getElementById("levels");
const shipsDiv = document.getElementById("ships");
const coinsTxt = document.getElementById("coinsTxt");
const shopBtn = document.getElementById("shopBtn");
const backBtn = document.getElementById("backBtn");

/* ================== STATE ================== */
let state = "MENU";
let raf;

/* ================== INPUT ================== */
let keys = {};
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

/* ================== SAVE ================== */
let coins = Number(localStorage.coins || 0);
let owned = JSON.parse(localStorage.owned || "[0]");
let equipped = Number(localStorage.equipped || 0);

/* ================== SHIPS ================== */
const ships = [
  (x,y)=>{ ctx.beginPath(); ctx.moveTo(x,y-18); ctx.lineTo(x-12,y+18); ctx.lineTo(x+12,y+18); ctx.fill(); },
  (x,y)=>{ ctx.beginPath(); ctx.moveTo(x,y-22); ctx.lineTo(x-18,y+18); ctx.lineTo(x,y+6); ctx.lineTo(x+18,y+18); ctx.fill(); },
  (x,y)=>{ ctx.beginPath(); ctx.moveTo(x,y-24); ctx.lineTo(x-14,y+18); ctx.lineTo(x+14,y+18); ctx.fill(); ctx.fillRect(x-4,y-6,8,16); },
  (x,y)=>{ ctx.beginPath(); ctx.moveTo(x,y-28); ctx.lineTo(x-10,y+18); ctx.lineTo(x+10,y+18); ctx.fill(); },
  (x,y)=>{ ctx.beginPath(); ctx.moveTo(x,y-20); ctx.lineTo(x-22,y+10); ctx.lineTo(x+22,y+10); ctx.fill(); }
];

/* ================== LEVELS ================== */
const levels = [
  {name:"ASTEROID DRIFT",d:1},
  {name:"NEBULA SWARM",d:2},
  {name:"CRIMSON FRONT",d:3},
  {name:"VOID ASSAULT",d:4},
  {name:"EXTINCTION ZONE",d:5},
  {name:"STELLAR SIEGE",d:6},
  {name:"NOVA BREACH",d:7},
  {name:"HELLSTAR ARMADA",d:8}
];

/* ================== BUILD MENU ================== */
levels.forEach((l,i)=>{
  const b=document.createElement("button");
  b.className="levelBtn";
  b.textContent=l.name;
  b.style.background=`rgb(${60+l.d*30},0,0)`;
  b.addEventListener("click",()=>startLevel(l));
  levelsDiv.appendChild(b);
});

/* ================== SHOP ================== */
shopBtn.onclick=()=>{
  state="SHOP";
  menu.classList.add("hidden");
  shop.classList.remove("hidden");
  drawShop();
};
backBtn.onclick=()=>{
  state="MENU";
  shop.classList.add("hidden");
  menu.classList.remove("hidden");
};
function drawShop(){
  shipsDiv.innerHTML="";
  coinsTxt.textContent=`Coins: ${coins}`;
  ships.forEach((_,i)=>{
    const b=document.createElement("button");
    const cost = i*200;
    if(owned.includes(i)){
      b.textContent=i===equipped?"EQUIPPED":"Equip Ship "+(i+1);
      b.onclick=()=>{equipped=i;save();}
    }else{
      b.textContent=`Buy Ship ${i+1} (${cost})`;
      b.onclick=()=>{ if(coins>=cost){ coins-=cost; owned.push(i); save(); drawShop(); } };
    }
    shipsDiv.appendChild(b);
  });
}

/* ================== GAME ================== */
let player, enemies=[], bullets=[], powerUps=[];
let fireCooldown=0;

function startLevel(level){
  state="PLAY";
  menu.classList.add("hidden");
  shop.classList.add("hidden");
  player={x:360,y:780,shots:1};
  enemies=[];
  bullets=[];
  powerUps=[];
  for(let r=0;r<3+level.d;r++){
    for(let c=0;c<8;c++){
      enemies.push({
        x:90+c*70,
        y:80+r*50,
        hp:1+Math.floor(level.d/2),
        dx:1+level.d*0.5,
        dive:false
      });
    }
  }
  loop();
}

function loop(){
  raf=requestAnimationFrame(loop);
  update();
  draw();
}

function update(){
  if(state!=="PLAY")return;
  if(keys.a)player.x-=6;
  if(keys.d)player.x+=6;
  if(keys.w)player.y-=6;
  if(keys.s)player.y+=6;
  if(keys[" "] && fireCooldown<=0){
    for(let i=0;i<player.shots;i++)
      bullets.push({x:player.x+i*6-player.shots*3,y:player.y});
    fireCooldown=15;
  }
  fireCooldown--;

  bullets.forEach(b=>b.y-=10);

  enemies.forEach(e=>{
    if(!e.dive && Math.random()<0.001*enemies.length) e.dive=true;
    if(e.dive) e.y+=3;
    else e.x+=e.dx;
  });

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(Math.abs(b.x-e.x)<18 && Math.abs(b.y-e.y)<18){
        e.hp--;
        bullets.splice(bi,1);
        if(e.hp<=0){
          enemies.splice(ei,1);
          coins+=5;
          if(Math.random()<0.3) powerUps.push({x:e.x,y:e.y});
        }
      }
    });
  });

  powerUps.forEach((p,i)=>{
    p.y+=2;
    if(Math.abs(p.x-player.x)<20 && Math.abs(p.y-player.y)<20){
      player.shots=3;
      powerUps.splice(i,1);
    }
  });

  if(enemies.length===0){
    save();
    cancelAnimationFrame(raf);
    state="MENU";
    menu.classList.remove("hidden");
  }
}

function draw(){
  ctx.clearRect(0,0,720,900);
  if(state!=="PLAY")return;
  ctx.fillStyle="white";
  ships[equipped](player.x,player.y);
  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));
  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x-16,e.y-16,32,32));
  ctx.strokeStyle="cyan";
  powerUps.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,10,0,Math.PI*2);
    ctx.stroke();
  });
  ctx.fillText(`Coins: ${coins}`,10,20);
}

function save(){
  localStorage.coins=coins;
  localStorage.owned=JSON.stringify(owned);
  localStorage.equipped=equipped;
}

/* ================== INIT ================== */
menu.classList.remove("hidden");
shop.classList.add("hidden");
</script>

</body>
</html>

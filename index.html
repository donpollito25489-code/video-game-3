<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaga: Void War</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:Arial;color:white}
canvas{display:block;margin:auto}
.overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,.85)}
button{padding:12px 26px;margin:8px;font-size:18px;border:none;border-radius:6px;font-weight:bold;cursor:pointer}
button:hover{transform:scale(1.05)}
#hud{position:absolute;top:10px;left:10px;font-size:14px}
</style>
</head>
<body>

<div id="menu" class="overlay">
<h1 style="font-size:52px">GALAGA: VOID WAR</h1>
<div id="levels"></div>
<p id="coins"></p>
</div>

<canvas id="game" width="600" height="800"></canvas>
<div id="hud"></div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
let run=false,paused=false;
let keys={},stars=[],player,enemies=[],pBullets=[],eBullets=[],powerUps=[],particles=[];
let score=0,lives=3,coins=+localStorage.getItem("coins")||0,level=0;

const levels=[
{name:"Outer Rim",d:1},{name:"Nebula Ambush",d:1.5},
{name:"Void Strike",d:2},{name:"Plasma Hell",d:2.6},
{name:"FINAL STAND",d:3.2}
];

document.addEventListener("keydown",e=>keys[e.key]=1);
document.addEventListener("keyup",e=>keys[e.key]=0);

for(let i=0;i<180;i++)stars.push({x:Math.random()*600,y:Math.random()*800,s:1+Math.random()*2});

function spawnPlayer(){
player={x:280,y:700,w:40,h:50,cd:0,spd:6,shots:1,rapid:0,pierce:0,shield:0,magnet:0};
}

function spawnWave(){
enemies=[];
let d=levels[level].d;
for(let r=0;r<3+level;r++)for(let c=0;c<6;c++)
enemies.push({x:60+c*80,y:60+r*50,w:40,h:30,hp:1+Math.floor(d),dx:(Math.random()<.5?1:-1)*(1+d),dive:false,a:0,cd:0});
}

function drawStars(){
ctx.fillStyle="white";
stars.forEach(s=>{ctx.fillRect(s.x,s.y,2,2);s.y+=s.s;if(s.y>800){s.y=0;s.x=Math.random()*600}});
}

function shoot(){
let spread=player.shots>1?[-8,0,8]:[0];
spread.forEach(o=>pBullets.push({x:player.x+player.w/2+o,y:player.y,dy:-10,p:player.pierce}));
}

function spawnPower(x,y){
const types=["triple","rapid","shield","pierce","magnet","life"];
const t=types[Math.floor(Math.random()*types.length)];
powerUps.push({x,y,t,r:0});
}

function applyPower(p){
if(p=="triple")player.shots=3,setTimeout(()=>player.shots=1,10000);
if(p=="rapid")player.rapid=1,setTimeout(()=>player.rapid=0,8000);
if(p=="pierce")player.pierce=1,setTimeout(()=>player.pierce=0,8000);
if(p=="shield")player.shield=3;
if(p=="magnet")player.magnet=1,setTimeout(()=>player.magnet=0,10000);
if(p=="life")lives++;
}

function update(){
if(!run)return;

if(keys.a&&player.x>0)player.x-=player.spd;
if(keys.d&&player.x+player.w<600)player.x+=player.spd;
if(keys.w&&player.y>400)player.y-=player.spd;
if(keys.s&&player.y+player.h<780)player.y+=player.spd;

if(keys[" "]&&player.cd<=0){shoot();player.cd=player.rapid?6:14}
if(player.cd>0)player.cd--;

pBullets.forEach(b=>b.y+=b.dy);
eBullets.forEach(b=>b.y+=b.dy);

enemies.forEach(e=>{
e.x+=e.dx;
if(Math.random()<.01*levels[level].d)e.dive=true;
if(e.dive){e.y+=4;e.x+=Math.sin(e.a)*3;e.a+=.1}
if(Math.random()<.02*levels[level].d&&e.cd<=0){eBullets.push({x:e.x+20,y:e.y+30,dy:6});e.cd=40}
if(e.cd>0)e.cd--;
});

pBullets=pBullets.filter(b=>{
let alive=true;
enemies.forEach((e,i)=>{
if(b.x>e.x&&b.x<e.x+e.w&&b.y>e.y&&b.y<e.y+e.h){
e.hp--; if(!b.p)alive=false;
if(e.hp<=0){enemies.splice(i,1);score+=10;coins+=5;if(Math.random()<.4)spawnPower(e.x,e.y)}
}});
return alive&&b.y>0;
});

eBullets=eBullets.filter(b=>{
if(b.x>player.x&&b.x<player.x+player.w&&b.y>player.y&&b.y<player.y+player.h){
if(player.shield>0)player.shield--;else lives--;
return false}
return b.y<800;
});

powerUps=powerUps.filter(p=>{
p.y+=2;p.r+=.1;
if(player.magnet){p.x+=(player.x-p.x)*.05;p.y+=(player.y-p.y)*.05}
if(p.x>player.x&&p.x<player.x+player.w&&p.y>player.y&&p.y<player.y+player.h){applyPower(p.t);return false}
return p.y<800;
});

if(enemies.length==0){level=(level+1)%levels.length;spawnWave()}

document.getElementById("hud").innerText=`Score ${score} | Lives ${lives} | Coins ${coins}`;
localStorage.setItem("coins",coins);
}

function draw(){
ctx.clearRect(0,0,600,800);
drawStars();

ctx.fillStyle="cyan";
ctx.beginPath();ctx.moveTo(player.x+20,player.y);ctx.lineTo(player.x,player.y+50);ctx.lineTo(player.x+40,player.y+50);ctx.fill();

if(player.shield){ctx.strokeStyle="rgba(0,200,255,.5)";ctx.beginPath();ctx.arc(player.x+20,player.y+25,35,0,Math.PI*2);ctx.stroke()}

ctx.fillStyle="yellow";pBullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));
ctx.fillStyle="red";eBullets.forEach(b=>ctx.fillRect(b.x,b.y,4,10));

enemies.forEach(e=>{ctx.fillStyle=e.hp>1?"orange":"purple";ctx.beginPath();ctx.moveTo(e.x+20,e.y);ctx.lineTo(e.x,e.y+30);ctx.lineTo(e.x+40,e.y+30);ctx.fill()});

powerUps.forEach(p=>{
ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);
ctx.fillStyle={triple:"lime",rapid:"yellow",shield:"cyan",pierce:"magenta",magnet:"red",life:"green"}[p.t];
ctx.beginPath();ctx.arc(0,0,10,0,Math.PI*2);ctx.fill();
ctx.restore();
});
}

function loop(){update();draw();requestAnimationFrame(loop)}

levels.forEach((l,i)=>{
let b=document.createElement("button");
b.innerText=l.name;
b.style.background=`rgb(${50+l.d*60},${255-l.d*60},0)`;
b.onclick=()=>{level=i;document.getElementById("menu").style.display="none";spawnPlayer();spawnWave();run=true};
document.getElementById("levels").appendChild(b);
});

loop();
</script>
</body>
</html>

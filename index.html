<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaga Space Battle</title>

<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
  font-family: Arial, sans-serif;
  color: white;
}

canvas {
  display: block;
  margin: auto;
}

#menu {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

button {
  padding: 12px 30px;
  margin: 10px;
  font-size: 18px;
  cursor: pointer;
}

#score {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 20px;
}
</style>
</head>

<body>

<div id="menu">
  <h1>GALAGA: SPACE WAR</h1>
  <button onclick="startGame(1)">Easy</button>
  <button onclick="startGame(2)">Medium</button>
  <button onclick="startGame(3)">Hard</button>
</div>

<div id="score"></div>
<canvas id="game" width="600" height="800"></canvas>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ================= SPACE BACKGROUND ================= */
let stars = Array.from({ length: 150 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 2,
  s: Math.random() * 1 + 0.5
}));

function drawStars() {
  ctx.fillStyle = "white";
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
    ctx.fill();
    star.y += star.s;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  });
}

/* ================= PLAYER ================= */
const shipImg = new Image();
let shipLoaded = false;
shipImg.src = "ship.png";
shipImg.onload = () => shipLoaded = true;

let player;

/* ================= GAME STATE ================= */
let enemies = [];
let enemyBullets = [];
let difficulty = 1;
let score = 0;
let level = 1;
let running = false;

/* ================= START GAME ================= */
function startGame(diff) {
  difficulty = diff;
  score = 0;
  level = 1;
  document.getElementById("menu").style.display = "none";

  player = {
    x: canvas.width / 2 - 30,
    y: canvas.height - 100,
    w: 60,
    h: 60,
    speed: 6,
    bullets: [],
    cooldown: 0
  };

  spawnEnemies();
  running = true;
  loop();
}

/* ================= ENEMIES ================= */
function spawnEnemies() {
  enemies = [];
  enemyBullets = [];

  for (let i = 0; i < 5 + level; i++) {
    enemies.push({
      x: Math.random() * (canvas.width - 50),
      y: Math.random() * 200,
      w: 50,
      h: 30,
      dx: (Math.random() < 0.5 ? -1 : 1) * (1 + difficulty),
      shootChance: 0.005 * difficulty
    });
  }
}

/* ================= UPDATE ================= */
function update() {
  if (!running) return;

  // Player movement
  if (keys.a && player.x > 0) player.x -= player.speed;
  if (keys.d && player.x + player.w < canvas.width) player.x += player.speed;
  if (keys.w && player.y > 0) player.y -= player.speed;
  if (keys.s && player.y + player.h < canvas.height) player.y += player.speed;

  // Shooting
  if (keys[" "] && player.cooldown <= 0) {
    player.bullets.push({ x: player.x + player.w / 2 - 2, y: player.y, dy: -8 });
    player.cooldown = 15;
  }
  if (player.cooldown > 0) player.cooldown--;

  player.bullets.forEach(b => b.y += b.dy);
  player.bullets = player.bullets.filter(b => b.y > -20);

  // Enemies
  enemies.forEach(e => {
    e.x += e.dx;
    if (e.x < 0 || e.x + e.w > canvas.width) e.dx *= -1;
    if (Math.random() < e.shootChance) {
      enemyBullets.push({ x: e.x + e.w / 2, y: e.y + e.h, dy: 4 + difficulty });
    }
  });

  enemyBullets.forEach(b => b.y += b.dy);

  // Bullet collisions
  player.bullets.forEach((b, bi) => {
    enemies.forEach((e, ei) => {
      if (
        b.x > e.x && b.x < e.x + e.w &&
        b.y > e.y && b.y < e.y + e.h
      ) {
        enemies.splice(ei, 1);
        player.bullets.splice(bi, 1);
        score += 10;
      }
    });
  });

  enemyBullets.forEach(b => {
    if (
      b.x > player.x && b.x < player.x + player.w &&
      b.y > player.y && b.y < player.y + player.h
    ) {
      gameOver();
    }
  });

  if (enemies.length === 0) {
    level++;
    spawnEnemies();
  }

  document.getElementById("score").innerText =
    `Score: ${score} | Level: ${level}`;
}

/* ================= DRAW ================= */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawStars();

  // Player
  if (shipLoaded) {
    ctx.drawImage(shipImg, player.x, player.y, player.w, player.h);
  } else {
    ctx.fillStyle = "cyan";
    ctx.beginPath();
    ctx.moveTo(player.x + player.w / 2, player.y);
    ctx.lineTo(player.x, player.y + player.h);
    ctx.lineTo(player.x + player.w, player.y + player.h);
    ctx.fill();
  }

  // Player bullets
  ctx.fillStyle = "yellow";
  player.bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));

  // Alien ships
  ctx.fillStyle = "purple";
  enemies.forEach(e => ctx.fillRect(e.x, e.y, e.w, e.h));

  // Enemy bullets
  ctx.fillStyle = "red";
  enemyBullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));
}

/* ================= LOOP ================= */
function loop() {
  update();
  draw();
  if (running) requestAnimationFrame(loop);
}

/* ================= GAME OVER ================= */
function gameOver() {
  running = false;
  document.getElementById("menu").style.display = "flex";
}
</script>

</body>
</html>
